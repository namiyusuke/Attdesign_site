---
import Layout from '../layouts/Layout.astro';
import { client, type Photo } from '../lib/microcms';

// microCMSからphotoデータを取得
const response = await client.getList<Photo>({
  endpoint: 'photo',
  queries: { limit: 25 },
});

const photos = response.contents;

// WebGLに渡すデータ（画像URLとリンク先）
const photoData = photos.map(p => ({
  imageUrl: p.image.url,
  linkUrl: `/photo#photo-${p.id}`,
}));
---

<Layout>
  <!-- イントロアニメーション用オーバーレイ -->
  <div id="intro-overlay" class="intro-overlay"></div>
  <!-- 写真フライアウト用オーバーレイ -->
  <div id="photo-overlay" class="photo-overlay">
    <img id="photo-overlay-img" class="photo-overlay__img" src="" alt="" />
  </div>
  <canvas id="webgl"></canvas>

  <script is:inline define:vars={{ photoData }} data-swup-reload-script>
    window.__PHOTO_DATA__ = photoData;
  </script>
</Layout>
