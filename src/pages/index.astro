---
import Layout from '../layouts/Layout.astro';
import { client, type Photo } from '../lib/microcms';

// microCMSからphotoデータを取得
const response = await client.getList<Photo>({
  endpoint: 'photo',
  queries: { limit: 25 },
});

const photos = response.contents;

// WebGLに渡すデータ（画像URLとリンク先）
const photoData = photos.map(p => ({
  imageUrl: p.image.url,
  linkUrl: `/photo#photo-${p.id}`,
}));
---

<Layout title="Photoire|日々の写真ログ" description="Photoire（フォトワール）は、くうみんが写真で残す日々の記録。毎日、1枚の写真に短いメモを添えて投稿しています。日付順や「街」「カフェ」「風景」「イベント」Viewで切り替え可能。気になるロゴや美術系イベントなど、デザイナー目線のフォトも掲載。">
   <div class="container js-scroll-hint-target">
      <svg width="600" height="400" viewBox="0 0 600 400">
        <!-- 8の字の軌跡（ガイドライン） -->
        <defs>
          <path id="motionPath" d="M300,200 C300,100 420,60 420,150 C420,240 300,200 300,200 C300,200 180,160 180,250 C180,340 300,300 300,200 Z" />
        </defs>
        <use href="#motionPath" class="track" />
        <!-- アニメーションするアイコン -->
        <g class="icon">
          <animateMotion dur="4s" repeatCount="indefinite" rotate="0" calcMode="spline" keySplines="0.42 0 0.58 1" keyTimes="0;1">
            <mpath href="#motionPath" />
          </animateMotion>
          <foreignObject width="60" height="94" x="-30" y="-47">
            <!-- スマホ用：スワイプハンド -->
            <svg class="scroll-hint-svg scroll-hint-mobile" width="60" height="94" viewBox="0 0 44 72" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M43.9167 24.462C43.9167 22.777 43.4624 21.3394 42.5988 20.303C41.7698 19.3034 40.587 18.7318 39.3558 18.7318C38.6586 18.7318 37.9545 18.919 37.3232 19.2868C36.9174 16.4785 34.6594 15.0142 32.4223 15.0142C31.1806 15.0142 29.932 15.4789 29.0024 16.3849C28.8289 16.0807 28.6278 15.7965 28.4058 15.5357C27.4832 14.4559 26.1687 13.8374 24.8056 13.8374C23.987 13.8374 23.276 14.0313 22.669 14.3589C22.6794 12.9447 22.6967 11.9652 22.7141 11.0525C22.7384 9.74537 22.7558 8.61536 22.7558 6.59276C22.7558 3.31645 21.07 0 17.8479 0C15.4928 0 12.9539 2.09619 12.9539 6.70304V30.5365C11.4451 29.0555 9.475 27.1232 8.32695 26.0098C5.51405 23.2718 2.89884 23.6395 1.51146 24.7862C-0.340694 26.3174 -0.798531 29.7074 1.90686 33.221C2.61789 34.1437 3.33933 35.1132 4.03996 36.0493C8.22288 41.6492 12.5446 47.4395 18.9405 50.5286C19.5405 50.8195 20.2688 50.5854 20.5706 50.0071C20.8724 49.4287 20.6296 48.7267 20.0296 48.4358C14.1679 45.6041 10.023 40.0511 6.01005 34.682C5.30594 33.7392 4.57756 32.7631 3.85613 31.827C1.94154 29.3396 2.25718 27.2501 3.0896 26.5615C3.87347 25.9129 5.24698 26.3441 6.59618 27.6546C8.62527 29.6271 13.2487 34.1705 13.2938 34.2173C13.6407 34.5583 14.1643 34.662 14.6188 34.4815C15.0766 34.3008 15.3748 33.8729 15.3748 33.3982V6.70304C15.3748 3.83796 16.6166 2.34022 17.841 2.34022C19.0653 2.34022 20.3209 3.80117 20.3209 6.59276C20.3209 8.59869 20.3001 9.71864 20.2792 11.0157C20.2515 12.6706 20.2168 14.5495 20.2168 18.8019C20.2168 18.8019 20.2168 18.8019 20.2168 18.8053V22.6031C20.2168 23.2484 20.7614 23.7733 21.4308 23.7733C22.1002 23.7733 22.6447 23.2484 22.6447 22.6031V18.7886C22.6482 16.9966 23.7616 16.1776 24.7987 16.1776C25.4473 16.1776 26.0612 16.4785 26.5259 17.0234C27.1537 17.7589 27.4867 18.8789 27.4867 20.263C27.4867 20.3097 27.4971 20.3532 27.5006 20.3966V24.462C27.5006 25.1072 28.0452 25.632 28.7146 25.632C29.3839 25.632 29.9284 25.1072 29.9284 24.462V20.1392C29.9284 20.1192 29.9215 20.0958 29.9215 20.0758C29.9979 18.0732 31.2951 17.3511 32.4119 17.3511C33.0675 17.3511 33.6813 17.5884 34.1357 18.023C34.6664 18.5312 34.9508 19.2834 34.9508 20.1961V24.0407C34.9508 24.0909 34.9613 24.1376 34.9647 24.1845V27.2568C34.9647 27.9021 35.5093 28.427 36.1786 28.427C36.848 28.427 37.3926 27.9021 37.3926 27.2568V23.6395C37.5174 21.8777 38.4609 21.0687 39.3454 21.0687C39.8447 21.0687 40.3234 21.3161 40.6946 21.7606C41.0518 22.192 41.4784 23.011 41.4784 24.4586C41.4784 26.4812 41.4993 28.4704 41.5235 30.58C41.5478 32.8901 41.5755 35.2804 41.5755 37.9416C41.5755 41.6591 40.2784 44.8653 37.9232 46.9748C37.1289 47.6835 36.2272 48.2954 35.2387 48.7868C34.6421 49.0843 34.4097 49.7898 34.715 50.3648C34.93 50.7659 35.3566 51 35.7937 51C35.9809 51 36.1717 50.9565 36.3486 50.8696C37.5313 50.2812 38.6169 49.549 39.5707 48.6932C42.4253 46.1357 44 42.3211 44 37.9449C44 35.2737 43.9723 32.8767 43.948 30.5599C43.9236 28.4571 43.9028 26.4745 43.9028 24.4653L43.9167 24.462Z" fill="white"/>
              <path d="M7.36333 69.2175C6.49333 69.2175 5.69099 69.029 4.95633 68.652C4.23133 68.2653 3.65616 67.6128 3.23083 66.6945L4.81133 65.8245C5.09166 66.3272 5.42999 66.7187 5.82633 66.999C6.22266 67.2793 6.75916 67.4195 7.43583 67.4195C8.10283 67.4195 8.54749 67.3083 8.76983 67.086C8.99216 66.854 9.10333 66.5495 9.10333 66.1725C9.10333 65.9308 9.04533 65.723 8.92933 65.549C8.82299 65.375 8.58133 65.2107 8.20433 65.056C7.83699 64.8917 7.26666 64.7177 6.49333 64.534C5.55566 64.3117 4.86449 63.954 4.41983 63.461C3.97516 62.968 3.75283 62.3542 3.75283 61.6195C3.75283 61.0105 3.89783 60.4788 4.18783 60.0245C4.47783 59.5702 4.88383 59.2173 5.40583 58.966C5.93749 58.705 6.56099 58.5745 7.27633 58.5745C7.93366 58.5745 8.51366 58.676 9.01633 58.879C9.51899 59.082 9.94433 59.3478 10.2923 59.6765C10.65 60.0052 10.9303 60.3628 11.1333 60.7495L9.63983 61.866C9.49483 61.634 9.31599 61.4068 9.10333 61.1845C8.90033 60.9525 8.64899 60.7592 8.34933 60.6045C8.04966 60.4498 7.68233 60.3725 7.24733 60.3725C6.79299 60.3725 6.42083 60.4692 6.13083 60.6625C5.85049 60.8462 5.71033 61.1362 5.71033 61.5325C5.71033 61.6872 5.74899 61.8467 5.82633 62.011C5.91333 62.1657 6.10666 62.3203 6.40633 62.475C6.71566 62.6297 7.20383 62.7892 7.87083 62.9535C9.00183 63.2242 9.81866 63.6302 10.3213 64.1715C10.8337 64.7032 11.0898 65.3605 11.0898 66.1435C11.0898 67.1392 10.7515 67.9028 10.0748 68.4345C9.40783 68.9565 8.50399 69.2175 7.36333 69.2175ZM13.9598 69L11.9733 62.011H13.7133L14.8298 66.448L15.9608 62.011H17.4833L18.5998 66.448L19.7308 62.011H21.4708L19.4698 69H17.8748L16.7148 64.5195L15.5548 69H13.9598ZM22.7682 69V62.011H24.5952V69H22.7682ZM23.6672 60.967C23.3579 60.967 23.0921 60.8558 22.8697 60.6335C22.6571 60.4112 22.5507 60.1453 22.5507 59.836C22.5507 59.5267 22.6571 59.2657 22.8697 59.053C23.0921 58.8307 23.3579 58.7195 23.6672 58.7195C23.9766 58.7195 24.2376 58.8307 24.4502 59.053C24.6726 59.2657 24.7837 59.5267 24.7837 59.836C24.7837 60.1453 24.6726 60.4112 24.4502 60.6335C24.2376 60.8558 23.9766 60.967 23.6672 60.967ZM26.4589 71.813V62.011H28.0394L28.1264 62.6635C28.6194 62.1125 29.2284 61.837 29.9534 61.837C30.6108 61.837 31.1956 61.982 31.7079 62.272C32.2203 62.5523 32.6214 62.968 32.9114 63.519C33.2111 64.0603 33.3609 64.7225 33.3609 65.5055C33.3609 66.2788 33.2111 66.941 32.9114 67.492C32.6214 68.0333 32.2203 68.449 31.7079 68.739C31.1956 69.0193 30.6108 69.1595 29.9534 69.1595C29.3251 69.1595 28.7693 68.942 28.2859 68.507V71.813H26.4589ZM29.8809 67.5065C30.3449 67.5065 30.7316 67.3373 31.0409 66.999C31.3599 66.651 31.5194 66.1532 31.5194 65.5055C31.5194 64.8482 31.3599 64.3503 31.0409 64.012C30.7316 63.664 30.3449 63.49 29.8809 63.49C29.4169 63.49 29.0303 63.664 28.7209 64.012C28.4116 64.3503 28.2569 64.8482 28.2569 65.5055C28.2569 66.1532 28.4116 66.651 28.7209 66.999C29.0303 67.3373 29.4169 67.5065 29.8809 67.5065ZM37.7745 69.1595C36.7498 69.1595 35.9185 68.8598 35.2805 68.2605C34.6425 67.6515 34.3235 66.7332 34.3235 65.5055C34.3235 64.7418 34.4636 64.0893 34.744 63.548C35.034 62.997 35.4303 62.5765 35.933 62.2865C36.4356 61.9868 37.0156 61.837 37.673 61.837C38.3303 61.837 38.8861 61.9965 39.3405 62.3155C39.8045 62.6248 40.1573 63.055 40.399 63.606C40.6406 64.157 40.7615 64.7902 40.7615 65.5055V65.897H36.1215C36.1698 66.5447 36.3438 66.9893 36.6435 67.231C36.9528 67.463 37.3395 67.579 37.8035 67.579C38.2288 67.579 38.5768 67.4775 38.8475 67.2745C39.1181 67.0715 39.3598 66.767 39.5725 66.361L40.9065 67.3035C40.5295 67.9705 40.08 68.449 39.558 68.739C39.0456 69.0193 38.4511 69.1595 37.7745 69.1595ZM36.194 64.505H38.9635C38.7895 63.6737 38.3496 63.258 37.644 63.258C37.2573 63.258 36.9431 63.3547 36.7015 63.548C36.4598 63.7413 36.2906 64.0603 36.194 64.505Z" fill="white"/>
            </svg>
            <!-- PC用：カーソル -->
            <svg class="scroll-hint-svg scroll-hint-pc" width="60" height="94" viewBox="0 0 48 57" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6.67575 0.717232C3.83798 -1.16875 -0.290249 0.858988 0.0161185 4.53234L0.105862 5.60168C1.4743 21.9533 4.36471 38.143 8.73987 53.9623C9.78276 57.7343 15.022 58.061 16.6126 54.5633L23.201 40.0887C23.8293 38.705 25.358 37.8175 27.0198 37.9931L43.3161 39.7312C47.0575 40.1318 49.7003 35.5833 46.7016 32.7019C34.6294 21.1047 21.5407 10.6048 7.59176 1.3274L6.67575 0.717232Z" fill="white"/>
            </svg>
          </foreignObject>
        </g>
      </svg>
    </div>

  <!-- イントロアニメーション用オーバーレイ -->
  <div id="intro-overlay" class="intro-overlay"></div>
  <!-- 写真フライアウト用オーバーレイ -->
  <div id="photo-overlay" class="photo-overlay">
    <img id="photo-overlay-img" class="photo-overlay__img" src="" alt="" />
  </div>
  <canvas id="webgl"></canvas>

  <script is:inline define:vars={{ photoData }} data-swup-reload-script>
    window.__PHOTO_DATA__ = photoData;
  </script>
  <style is:global>
  .container {
    position: fixed;
    width: calc(336 / 375 * 100cqw);
    height: calc(200 / 375 * 100cqw);
    margin: auto;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 8px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  .scroll-hint-svg{
    display: block;
    width: min(calc(50 / 375 * 100cqw), 50px);
    margin: auto;
    max-inline-size: none;
  }
  .scroll-hint-pc{
    display: none;
  }
  @media (min-width:768px) {
    .container {
      display: none;
    }
  .scroll-hint-mobile{
    display: none;
  }
  .scroll-hint-pc{
    display: block;
  }
  .scroll-hint-svg{
    width: min(calc(30 / 1440 * 100cqw), 30px);
  }
  .container {
    position: fixed;
    width: calc(500 / 1440 * 100cqw);
    height: calc(300 / 1440 * 100cqw);
    margin: auto;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 8px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  }
.-intro-completed .container{
    opacity: 1;
    visibility: visible;
}
  /* 軌跡を薄く表示 */
  .track {
    fill: none;
    stroke:transparent;
    stroke-width: 1.5;
    stroke-dasharray: 6 4;
  }
  /* アイコンのドロップシャドウ */
  .icon {
    filter: drop-shadow(0 0 12px rgba(255,255,255,0.4));
  }
  </style>
</Layout>
